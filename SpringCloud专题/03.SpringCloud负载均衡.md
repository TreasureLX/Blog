### SpringCloud负载均衡

**RestTemple原理与扩展**

Spring核心HTTP消息转接器`HttpMessageConverter`

REST自描述消息：媒体类型（`MediaType`）: text/html;text/xml;application/json

HTTP协议特点：纯文本，自我描述

* REST服务端

* REST客户端

  文本转换成对象（序列化）

  对象转换成文本（反序列化）

`HttpMessageConverter`分析

```java
public interface HttpMessageConverter<T> {
    //判断是否可读
	boolean canRead(Class<?> clazz, @Nullable MediaType mediaType);
	//判断是否可写
	boolean canWrite(Class<?> clazz, @Nullable MediaType mediaType);
    //当前支持的媒体类型
	List<MediaType> getSupportedMediaTypes();

	T read(Class<? extends T> clazz, HttpInputMessage inputMessage)
			throws IOException, HttpMessageNotReadableException;
	
	void write(T t, @Nullable MediaType contentType, HttpOutputMessage outputMessage)
			throws IOException, HttpMessageNotWritableException;
}
```

特别提醒：SpringWebMVC依赖Servlet，Spring在早期设计的时候，它就考虑到了去Servlet化。`HttpInputMessage`类似于HttpServletRequest。

```java
public interface HttpInputMessage extends HttpMessage {
	//
	InputStream getBody() throws IOException;
    //来自父类
    HttpHeaders getHeaders();
}
```

RestTemplate 利用 `HttpMessageConverter`对一定媒体类型序列化和反序列化 ==> JSON，XML，TEXT

它不依赖于Servlet API，它自定义实现

对于服务端而言，将Servlet API 适配成 `HttpInputMessage` 以及 `HttpOutPutMessage`

RestTemplate对应多个`HttpMessageConverter`怎么判断媒体类型



* 内建`HttpMessageConverter`实现
* 有条件地添加第三方库`HttpMessageConverter`整合实现

问题场景一：http://localhost:8080/person -> XML 而不是JSON

PostMan,curl工具现象最明显

没有传递请求头，无从选择媒体类型



#### RestTemplate扩展

**扩展HTTP客户端**





**Netflix Ribbon**







