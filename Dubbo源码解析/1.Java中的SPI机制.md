# JAVA中的SPI机制

#### 1. SPI简介

​	SPI(Service Provider Interfaces)是java中的一种插件机制，更详细的介绍可以参考[SPI官方文档](https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html)。在一个项目中可能会引入多个模块的功能，最常见的就是数据库驱动。以MySql和Oracle的JDBC驱动为例，当我们在项目中引入MySQL的驱动时，系统可以自动加载该驱动。当我们要更换驱动时只需把Oracle驱动引入即可。下面我会通过MySQL驱动中的SPI实现和自己实现一个SPI机制来深入了解。

#### 2. SPI实现规则  

要实现一个SPI机制，主要有三个步骤

* 创建接口和实现类

* 在classpath下创建三个文件（META-INF和services是文件夹，最后一个是文件），比如严格按照格式创建，不然不能加载实现类。格式如下：

  ```
  META-INF
  └── services
      └── 接口/抽象类全名（包括包名）
  ```

  并且在“接口/抽象类全名”文件中填写实现类的全名

* 使用ServiceLoader加载类，代码如下所示：

  ```java
  ServiceLoader<Driver> loadedDrivers = ServiceLoader.load(interface.class);
  ```

#### 3. SPI具体实现

* MySQL驱动中SPI机制的使用，核心代码在` java.sql.DriverManager#loadInitialDrivers`中，有兴趣的小伙伴可以去查看一下更加详细的代码，核心代码如下所示：

  ```java 
  AccessController.doPrivileged(new PrivilegedAction<Void>() {
              public Void run() {
                  //加载所有实现了java.sql.Driver接口的驱动
                  ServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);
                  Iterator<Driver> driversIterator = loadedDrivers.iterator();
                  try{
                      while(driversIterator.hasNext()) {
                          driversIterator.next();
                      }
                  } catch(Throwable t) {
                  // Do nothing
                  }
                  return null;
              }
          });
  ```

* 自己实现SPI机制

  1. 创建接口和实现类，一个接口和两个实现类，为了实现类似数据库驱动的效果，将他们放在三个项目中，项目结构如下图所示：

     ![项目结构图](data:image/png;base64,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%0AiyIyl5YXIaKdFkDr7DNvZsYb0G7HbCxbACYsAZuIyEFgT/55GfuL+x2XL/3H%0Av9cuPFdATnab1m9oLwNwTuSYhsTRWcxMHMdx8fP4QrihfWqIQD53Lo10QmTa%0AG0VgJILCOcBobZIV6fF8IqFvOoGMyMxX5NOSfYyRyCLGiyLYN/AeEFFw9V3G%0A3DRZOkAGEb38MFGIWbJfITyKcWSRjU3BbEZSb59q4TSiS0Z5I4JMbEUE4srq%0AFJbME3URVYu216CJaGcJbAcTt6swZPmibsasss8CpnoeAOVVGSJ7nirbAjUR%0A7Ww7MmNWpYd4FLf1eiJERA76ssYs/cMTXzd//sdjT2o/yGt71RUUKayU0+xe%0ATUS+FNhShpemTv4REflMX2bMDMBEFGQ7ssZMRORnKmO++es/7PU8iIhIx4yZ%0AiMhnGJiJiHyGgZmIyGcYmImIfIaBOWDK5d341ydvx3i53OupENE2Cex1zJ+7%0A65Pqv+/++j187A8/qn7+4Opv8PZrl/Hx3TfgE5+6Eb93TQi/+7CMrV/8Wm1H%0ARBQEgQzMH73xOvNnIyhL1+36CD55+271X4MMzrs/8/sMzEQUGIEsZey68Xrz%0A51+9/X94q3hZZcuSDMryZ7nsnctX1bJrr7umJ/MkImpFIDPm63Zp05aB91dv%0AvaN+fvfX76ugLEsXspzx4YdaDfbG3btq9i+Xd+HrX70Tt/5nAXgwinv15S+9%0A8AP89ashfZvdWJiprAMu4bGpAhZDIX3dZ/D6C5fxpQdvwef0fScQxVsP3qS2%0A/vn3/xt/+vJV23Hv+PMvYPXuq+Y444e+iKdRwKe+jZbGI6L+FOiM+YqlPCFL%0AFpIsWRhB2fC7D51PlN0rgt7pqR+obz5+6oVL4nlUnVQzgvKtIhjKddp64OmZ%0AqOWk28fwyJ8BR8T+2r5/grf2XtK2PXEeuPuWmhN0r7z8Ezz2s5vw9/fcgPLe%0A2/H0TeeR+Pallscjov4UuMB87fXXmEH4vXfeN5fv0uvO773zgWWZFsCvWraz%0AeukFLXNV8ufxrYs34T7ZISp2E+69eB5HvnelsrF1vfIuvrV4Hq/I/fOX8JJ8%0AfkYPsr+8gtexC9E/qj3mC98u4PW77xSZ8K7K/m2MR0T9J3CBedfHtWAr68jW%0AzNg44WfUmiXjJOEHV3/boaO/i9e3OjQUEZGLwAXm627Q6svvX6kEWyMAy5LF%0A+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)

     接口（java-spi-api）：

     ```
     package com.alkx.java.spi.api;
     
     public interface IUserService {
         void sayHello();
     }
     ```

     实现类一(java-spi-service1)：

     ```
     package com.alkx.java.spi.service1;
     
     import com.alkx.java.spi.api.IUserService;
     
     public class UserServiceImpl1 implements IUserService {
         @Override
         public void sayHello() {
             System.out.println("service1");
         }
     }
     ```

     实现类二（java-spi-service2）：

     ```
     package com.alkx.java.spi.service2;
     
     import com.alkx.java.spi.api.IUserService;
     
     public class UserServiceImpl2 implements IUserService {
         @Override
         public void sayHello() {
             System.out.println("service2");
         }
     }
     ```

  2. 编写配置文件

     在每个项目的classpath路径中的META-INF/services/com.alkx.java.spi.api.IUserService文件中添加实现类的全名：

     ```
     com.alkx.java.spi.service1.UserServiceImpl1
     ```

     和

     ```
     com.alkx.java.spi.service2.UserServiceImpl2
     ```

  3. 通过SPI调用服务（java-spi-test），在测试项目引入哪个jar包，该jar包中的实现类就会调用，代码如下所示：

     ```
     		<dependency>
                 <groupId>com.alkx.java.spi</groupId>
                 <artifactId>java-spi-service1</artifactId>
                 <version>1.0-SNAPSHOT</version>
             </dependency>
             <dependency>
                 <groupId>com.alkx.java.spi</groupId>
                 <artifactId>java-spi-service2</artifactId>
                 <version>1.0-SNAPSHOT</version>
             </dependency>
     ```

     ```
     package com.alkx.java.spi.test;
     import com.alkx.java.spi.api.IUserService;
     import java.util.Iterator;
     import java.util.ServiceLoader;
     public class TestSPI {
         public static void main(String[] args) {
             //获取所有实现IUservice接口的SPI（Service provider Interfaces）
             ServiceLoader<IUserService> serviceLoader = ServiceLoader.load(IUserService.class);
             Iterator<IUserService> iUserServiceIterator = serviceLoader.iterator();
             //遍历调用服务
             while (iUserServiceIterator.hasNext()) {
                 IUserService userService = iUserServiceIterator.next();
                 userService.sayHello();
             }
         }
     }
     ```

* Demo地址：https://gitee.com/lockedx/java-spi

#### 4. 总结

​	通过上面的使用和分析，发现很多有名的插件厂商在使用JAVA的SPI机制来提供服务，极大的提高了程序的扩展性。把JAVA的SPI机制放在Dubbo中学习是因为Dubbo借鉴了它的机制，Dubbo用类似SPI的方式实现了扩展点机制，所以本篇文章是学习Dubbo扩展点机制的前提。在下一篇文章中我将会分析Dubbo的扩展点机制，敬请期待 。

​	如果你觉得文章不错就给个Star吧，(〃'▽'〃)，我的文章大部分是源码分析，而且大部分是关于分布式的，并且会持续更新。

gitHub : https://github.com/TreasureLX/Blog

osChina：https://gitee.com/lockedx/Blog

